C51 COMPILER V9.54   KEYS                                                                  10/18/2015 14:59:13 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEYS
OBJECT MODULE PLACED IN .\Objects\keys.obj
COMPILER INVOKED BY: D:\app\dev_tools\keilC51\C51\BIN\C51.EXE src\keys.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc) DEBUG OB
                    -JECTEXTEND PRINT(.\Listings\keys.lst) TABS(2) OBJECT(.\Objects\keys.obj)

line level    source

   1          #include <keys.h>
   2          #include <reg52.h>
   3          #include <time.h>
   4          #include <monitor.h>
   5          
   6          void key_init(void){
   7   1      
   8   1        //下降沿
   9   1        IT0=1;
  10   1        IT1=1;
  11   1        IT2=1;
  12   1      
  13   1        EX0=1;
  14   1        EX1=1;
  15   1        EX2=1;
  16   1      
  17   1      }
  18          
  19          //MODE_NM:正常运行模式    false
  20          //MODE_WRITE:设定时刻模式 true
  21          //typedef enum{MODE_NM,MODE_WRITE=!MODE_NM} MODE;
  22          //MODE PROG_MODE=MODE_NM;
  23          
  24          bool PROG_MODE=false;
  25          
  26          int time_index=0;//设定时间索引
  27          //0              1 2 3-----10
  28          //current_time   user_time[0]----user_time[9]
  29          //1              2 3 4 ----11
  30          
  31          TIME_TYPE time_buf={0,0,0};//按键输入时间信息缓存
  32          u8 state_buf=0;//按键输入通断信息缓存
  33          
  34          //KEY_CHOS 0   1   2   3   4
  35          //          min     hour   state
  36          //最开始位于数码管最低位，按一次向上一位（循环）
  37          u8 chos_count=0;
  38          
  39          //KEY_MODE
  40          void MODE_Handler(void) interrupt 0 {
  41   1         delay(20);//消抖
  42   1        if (PROG_MODE==true)
  43   1        {
  44   2          if (time_index==0)
  45   2          {
  46   3            current_time=time_buf;//初始化当前时间
  47   3            timer_start();
  48   3          }else{
  49   3            (user_time+time_index-1)->time=time_buf;//设定通断时间表
  50   3            (user_time+time_index-1)->state=state_buf;
  51   3          }
  52   2          time_index++;//次数太多造成数组越界！！！！
  53   2          
  54   2          //设定完成后缓存  显示清零
C51 COMPILER V9.54   KEYS                                                                  10/18/2015 14:59:13 PAGE 2   

  55   2          num1[0]=0;  
  56   2          num1[1]=0;
  57   2          num1[2]=0;
  58   2          num1[3]=0;
  59   2          
  60   2          LED9=1;
  61   2          
  62   2          chos_count=0;
  63   2          
  64   2          time_buf.min=0;
  65   2          time_buf.hour=0;
  66   2          state_buf=0;
  67   2        }
  68   1        PROG_MODE=!PROG_MODE;
  69   1        
  70   1      }
  71          
  72          
  73          
  74          void CHOS_Handler(void) interrupt 2 {
  75   1        delay(20);//消抖
  76   1        if (PROG_MODE==true)
  77   1        {
  78   2          chos_count++;
  79   2          if (chos_count>=5)
  80   2          {
  81   3            chos_count=0;
  82   3          }
  83   2        }
  84   1      }
  85          
  86          //KEY_STEP
  87          void STEP_Handler(void) interrupt 6 {
  88   1        delay(20);//消抖
  89   1        //num1[4]={time_buf.min%10,time_buf.min/10,time_buf.hour%10,time_buf.hour/10};
  90   1        
  91   1        if (PROG_MODE==true)
  92   1        {
  93   2          switch(chos_count){
  94   3            case 0:
  95   3              time_buf.min++;
  96   3              if (time_buf.min>=60)
  97   3              {
  98   4                time_buf.min=0;
  99   4                time_buf.hour++;
 100   4              }
 101   3            break;
 102   3            case 1:
 103   3              time_buf.min=time_buf.min+10;
 104   3              if (time_buf.min>=60)
 105   3              {
 106   4                time_buf.min=0;
 107   4                time_buf.hour++;
 108   4              }
 109   3            break;
 110   3            case 2:
 111   3              time_buf.hour++;
 112   3              if (time_buf.hour>=24)
 113   3              {
 114   4                time_buf.hour=0;
 115   4              }
 116   3            break;
C51 COMPILER V9.54   KEYS                                                                  10/18/2015 14:59:13 PAGE 3   

 117   3            case 3:
 118   3              time_buf.hour=time_buf.hour+10;
 119   3              if (time_buf.hour>=24)
 120   3              {
 121   4                time_buf.hour=0;
 122   4              }
 123   3            break;
 124   3            case 4:
 125   3              if(time_index>=1){
 126   4                state_buf=!state_buf;
 127   4                if (state_buf)
 128   4                {
 129   5                  LED9=0;//亮--通
 130   5                }else{
 131   5                  LED9=1;//灭--断
 132   5                }
 133   4              }
 134   3            break;
 135   3          }
 136   2          num1[0]=time_buf.min%10;
 137   2          num1[1]=time_buf.min/10;
 138   2          num1[2]=time_buf.hour%10;
 139   2          num1[3]=time_buf.hour/10;
 140   2        }
 141   1        
 142   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    486    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
